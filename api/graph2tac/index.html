<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>Graph2Tac &amp; Text2Tac</title>

  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="description" content="Tactician">
  
  <meta name="generator" content="Hugo 0.119.0">

  
  
  
  
  <link rel="stylesheet" href="https://coq-tactician.github.io/plugins/bootstrap/bootstrap.min.css" media='screen'>
  
  
  
  <link rel="stylesheet" href="https://coq-tactician.github.io/plugins/themify-icons/themify-icons.css" >
  
  
  
  <link rel="stylesheet" href="https://coq-tactician.github.io/plugins/featherlight/featherlight.min.css" >
  
  

  
  
  <link rel="stylesheet" href="https://coq-tactician.github.io/scss/style.css" media="screen">

  
  <link rel="shortcut icon" href="https://coq-tactician.github.io/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="https://coq-tactician.github.io/images/favicon.ico" type="image/x-icon">

  
  

  
  <meta property="og:title" content="Graph2Tac &amp; Text2Tac" />
<meta property="og:description" content="Graph2Tac is a novel neural network architecture for predicting appropriate tactics for proof states. The crucial innovation of Graph2Tac is that it can build an understanding of the math concepts in an entire Coq development and all of its dependencies on-the-fly. That is, it analyzes the structure of definitions and lemmas and builds an internal representation of each object in the global context. Then, when presented with a proof state that references these mathematical concepts, Graph2Tac can leverage its deep knowledge to predict tactics and arguments." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://coq-tactician.github.io/api/graph2tac/" /><meta property="article:section" content="api" />



  
  

</head>
<body><!-- navigation -->
<header class="sticky-top navigation ">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-light bg-transparent">
      <a class="navbar-brand" href="/">
        <img class="img-fluid" src="https://coq-tactician.github.io/images/logo.png" alt="Tactician">
        Tactician
      </a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h4 text-dark"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <ul class="navbar-nav mx-auto align-items-center">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://coq-tactician.github.io/manual/quick">Manual</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://coq-tactician.github.io/api/introduction">API</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://coq-tactician.github.io/publications">Publications</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://coq-tactician.github.io/people">People</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://coq-tactician.github.io/demo.html">Demo</a>
          </li>
          
          
          <li class="nav-link">
            
            
          </li>
        </ul>

        
        <div class="d-lg-none d-block">
          
          <a href="https://github.com/coq-tactician"
            class="btn btn-sm btn-outline-primary ml-lg-4">Github</a>
          
          <a href="https://coq-tactician.github.io/changelog"
            class="btn btn-sm btn-primary ml-lg-4">changelog</a>
          
        </div>
        
      </div>

      

      
      <div class="d-lg-flex d-none">
        
        <a href="https://github.com/coq-tactician"
          class="btn btn-sm btn-outline-primary ml-lg-4">Github</a>
        
        <a href="https://coq-tactician.github.io/changelog"
          class="btn btn-sm btn-primary ml-lg-4">changelog</a>
        
      </div>
      
    </nav>
  </div>
</header>
<!-- /navigation -->


<!-- details page -->
<section class="pt-5">
  <div class="container shadow section-sm rounded">
    <div class="row">
      <div class="col-lg-3 col-md-4 d-none d-md-block">
        <ul class="sidenav">
          
          
          
          
          
          
          








<li data-nav-id="https://coq-tactician.github.io/manual/" title="Manual"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/manual/">Manual</a>
  
  
  <ul>
    
    
    

    
    








<li data-nav-id="https://coq-tactician.github.io/manual/quick/" title="Quick start"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/manual/quick/">Quick start</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/manual/installation/" title="Installation"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/manual/installation/">Installation</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/manual/usage/" title="Usage"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/manual/usage/">Usage</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/manual/coq-packages/" title="Coq packages"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/manual/coq-packages/">Coq packages</a>
  
  


    
  </ul>
</li>



          
          
          
          
          
          
          
          
          
          
          
          








<li data-nav-id="https://coq-tactician.github.io/api/" title="API"
  class="sidelist parent ">
  <a href="https://coq-tactician.github.io/api/">API</a>
  
  
  <ul>
    
    
    

    
    








<li data-nav-id="https://coq-tactician.github.io/api/introduction/" title="API Introduction"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/api/introduction/">API Introduction</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/api/graph2tac/" title="Graph2Tac &amp; Text2Tac"
  class="sidelist  active">
  <a href="https://coq-tactician.github.io/api/graph2tac/">Graph2Tac &amp; Text2Tac</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/api/commands/" title="Coq Commands"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/api/commands/">Coq Commands</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/api/pytactician/" title="PyTactician"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/api/pytactician/">PyTactician</a>
  
  


    
    








<li data-nav-id="https://coq-tactician.github.io/api/datasets/" title="Datasets"
  class="sidelist  ">
  <a href="https://coq-tactician.github.io/api/datasets/">Datasets</a>
  
  


    
  </ul>
</li>



          
          
        </ul>
      </div>
      <div class="col-md-8">
        <div class="px-lg-5 px-4">
          <h2 class="mb-4 font-weight-medium">Graph2Tac &amp; Text2Tac</h2>
          
          <div class="content"><p><strong>Graph2Tac</strong> is a novel neural network architecture for predicting appropriate
tactics for proof states. The crucial innovation of Graph2Tac is that it can
build an understanding of the math concepts in an entire Coq development and all
of its dependencies on-the-fly. That is, it analyzes the structure of
definitions and lemmas and builds an internal representation of each object in
the global context. Then, when presented with a proof state that references
these mathematical concepts, Graph2Tac can leverage its deep knowledge to
predict tactics and arguments.</p>
<p><strong>Text2Tac</strong> is a language model for synthesizing tactics. It receives the
current proof state as a human-readable prompt and &ldquo;completes&rdquo; this prompt by
synthesizing a tactic.</p>
<p>Comparison in capabilities of Graph2Tac, Text2Tac and Tactician&rsquo;s default k-NN
model:</p>
<ul>
<li><strong>Representations:</strong> Graph2Tac is the only model that has deep background
knowledge of the mathematical concepts in a library. Text2Tac and k-NN are
informed only by the current proof state. References to objects in the global
context are not resolved.</li>
<li><strong>Tactic prediction:</strong> All three models predict tactics in different ways,
with unique advantages and disadvantages.
<ul>
<li>Text2Tac is capable, at least in principle, of generating completely
free-form tactic expressions. However, because it has no knowledge of the
tactics and lemmas currently available in Coq, it is forced to &ldquo;hallucinate&rdquo;
tactics.</li>
<li>Graph2Tac, takes a more structured approach in generating tactics. It first
chooses a &ldquo;base&rdquo; tactic, without any arguments, from a pre-defined set. For
example, <code>apply _</code>. Then, it predicts an argument each &ldquo;hole&rdquo; in the tactic.
Arguments are pointers into the knowledge graph given to the model. Therefore,
arguments are always valid objects. A downside is that Graph2Tac is unable to
synthesize arbitrary terms as arguments. It is also incapable of leveraging
previously unseen tactics defined by users.</li>
<li>The k-NN model sees tactics and their arguments as a black box. It is only
capable of predicting the exact tactic and argument combinations that
already exist in its database. However, this model is capable of learning
from previous proof scripts on-the-fly. This is rather powerful in practice,
because it can learn to use new user-defined tactics and can &ldquo;borrow&rdquo; script
fragments from similar proofs defined close-by.</li>
</ul>
</li>
<li><strong>Speed:</strong> The k-NN model is two order of magnitude faster than Graph2Tac,
which in turn is an order of magnitude faster than Text2Tac.</li>
</ul>
<p>Below is an overview of how Graph2Tac is trained to create definition
embeddings and predict tactics and arguments.</p>
<img src="/images/graph2tac-overview.svg" alt="Graph2Tac Overview" width="100%">
<h3 id="installation">Installation</h3>
<p>Graph2Tac and Text2Tac are proving agents implemented in Python.
It is highly recommended that you use a
<a href="https://docs.python.org/3/tutorial/venv.html">virtual environment</a>
or <a href="https://docs.conda.io/en/latest/">conda</a> environment to install them.</p>
<p>Graph2Tac is compatible with Python 3.9-3.11, while Text2Tac is compatible with
Python 3.9-3.10. Install one (or both) of the agents using:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install -i https://pypi.org/simple --extra-index-url https://test.pypi.org/simple/ graph2tac<span style="color:#f92672">==</span>1.0.4
</span></span><span style="display:flex;"><span>pip install -i https://pypi.org/simple --extra-index-url https://test.pypi.org/simple/ text2tac<span style="color:#f92672">==</span>0.1
</span></span></code></pre></div><p>Make sure that whenever you start Coq, the virtualenv where you made the
installation is available in your <code>PATH</code>.</p>
<p>Pre-trained models compatible with these agents are available in the Opam
packages <code>coq-graph2tac</code> and <code>coq-text2tac</code>. These packages contain all
configuration details needed to make Tactician interface with the agents. For
installation Opam &gt;= 2.1 is recommended. Opam will prompt you to install Cap&rsquo;n
Proto and XXHash through you system package manager. If your
system does not readily provide these packages, please consult the
<a href="https://github.com/coq-tactician/coq-tactician-api#prerequisites">prerequisites</a>
page on Github for alternatives.</p>
<p>Make sure that you have an Opam switch available with the Coq repositories
available. For example, you can create one as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone git@github.com:LasseBlaauwbroek/opam-coq-archive.git --depth<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>opam switch create tactician ocaml-base-compiler.4.11.2 --repos<span style="color:#f92672">=</span>coq-released-lasse<span style="color:#f92672">=</span>file://opam-coq-archive/released,default
</span></span></code></pre></div><p>Then run either one of these commands (you cannot run both; <code>coq-graph2tac</code> and
<code>coq-text2tac</code> are mutually incompatible).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>opam install coq-graph2tac coq-tactician-stdlib
</span></span><span style="display:flex;"><span>opam install coq-text2tac coq-tactician-stdlib
</span></span></code></pre></div><p>If you which to instrument packages beyond Coq&rsquo;s stdlib, the following command
will inject Tactician in Opam&rsquo;s compilation process. You can then install
additional packages as normal.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tactician inject
</span></span></code></pre></div><h3 id="usage">Usage</h3>
<p>Whenever you perform any command-line actions that involve Coq while you wish to
use Graph2Tac or Text2Tac, you have to prefix those commands with <code>tactician exec</code>. This will ensure that everything is loaded correctly. For example, you do
this when starting your editor or when building a project using <code>dune</code> or
<code>make</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tactician exec -- coqc ...
</span></span><span style="display:flex;"><span>tactician exec -- coqide ...
</span></span><span style="display:flex;"><span>tactician exec -- make ...
</span></span><span style="display:flex;"><span>tactician exec -- dune build ...
</span></span><span style="display:flex;"><span>tactician exec -- emacs ...
</span></span></code></pre></div><p>Usage of Graph2Tac and Text2Tac is similar to the usage of Tactician&rsquo;s default
model. You can ask the model for <code>Suggest</code>ions and ask it to <code>synth</code>esize
proofs. More detailed descriptions of Tactician&rsquo;s tactics are commands are in
the <a href="../../manual/usage">manual</a>.</p>
<p>There is one important additional command to use. Tactician&rsquo;s API synchronizes
Coq&rsquo;s entire global context with the external agent when it starts a proof
search. This can be an expensive operation. However, it is possible to introduce
cache points in a document, where the global context is proactively synchronized
with the agent. After a cache point, only new items in the global context need
to be synchronized. This greatly speeds up initialization of a prediction.
Creating a cache point is done using</p>
<pre tabindex="0"><code>Tactician Neural Cache.
</code></pre><p>Alternatively, you can automatically create new cache points after every new Coq
command using the option</p>
<pre tabindex="0"><code>Set Tactician Autocache.
</code></pre><h3 id="example">Example</h3>
<p>Start CoqIDE through <code>tactician exec coqide</code>, and try the following example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-coq" data-lang="coq"><span style="display:flex;"><span>From Tactician <span style="color:#f92672">Require</span> <span style="color:#f92672">Import</span> Ltac1<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">(* Set Tactician to automatically introduce external caching points *)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Set</span> Tactician Neural Autocache<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Inductive</span> mynat <span style="color:#f92672">:</span> <span style="color:#f92672">Set</span> <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> my0 <span style="color:#f92672">:</span> mynat
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> myS <span style="color:#f92672">:</span> mynat <span style="color:#f92672">-&gt;</span> mynat<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Fixpoint</span> myadd n m <span style="color:#f92672">:=</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">match</span> n <span style="color:#66d9ef">with</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> my0 <span style="color:#f92672">=&gt;</span> m
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> myS n <span style="color:#f92672">=&gt;</span> myS <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> where <span style="color:#e6db74">&#34;n + m&#34;</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">(</span>myadd n m<span style="color:#f92672">).</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Lemma</span> my_comm <span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> n m<span style="color:#f92672">,</span> n <span style="color:#f92672">+</span> m <span style="color:#f92672">=</span> m <span style="color:#f92672">+</span> n<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Proof</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">(* Commutativity requires three separate inductions.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   That is too much. But Graph2Tac can do the inductions separately.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   Text2Tac cannot. *)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">induction</span> n<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> synth<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> synth<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Qed</span><span style="color:#f92672">.</span>
</span></span></code></pre></div></div>
          
          
        </div>
      </div>
    </div>
  </div>
</section>
<!-- /details page -->





<footer>
  <div class="container">
    <div class="row align-items-center border-bottom py-5">
      <div class="col-lg-4">
        <ul class="list-inline footer-menu text-center text-lg-left">
          
        </ul>
      </div>
      <div class="col-lg-4 text-center mb-4 mb-lg-0">
        <a class="navbar-brand" href="/">
          <img class="img-fluid" src="https://coq-tactician.github.io/images/logo.png" alt="Tactician">
          Tactician
        </a>
      </div>
      <div class="col-lg-4">
        <ul class="list-inline social-icons text-lg-right text-center">
          
        </ul>
      </div>
    </div>
    <div class="py-4 text-center">
      <small class="text-light"></small>
    </div>
  </div>
</footer>


<script type="text/javascript">
  var indexURL = "https://coq-tactician.github.io/index.json";
  
  var baseurl = "https:\/\/coq-tactician.github.io\/";
  
</script>





<script src="https://coq-tactician.github.io/plugins/jQuery/jquery.min.js" ></script>



<script src="https://coq-tactician.github.io/plugins/bootstrap/bootstrap.min.js" ></script>



<script src="https://coq-tactician.github.io/plugins/masonry/masonry.min.js" ></script>



<script src="https://coq-tactician.github.io/plugins/featherlight/featherlight.min.js" ></script>



<script src="https://coq-tactician.github.io/plugins/clipboard/clipboard.min.js" ></script>



<script src="https://coq-tactician.github.io/plugins/match-height/jquery.matchHeight-min.js" ></script>





<script src="https://coq-tactician.github.io/js/script.min.js"></script>
</body>

</html>
